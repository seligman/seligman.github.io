<html><head>
<!--
    Test IPs:
AWS:    3.2.34.0
        2600:1ff2:4000::
Google: 34.80.0.0
        2600:1900:4030::
Azure:  40.126.0.0
        2a01:111:f403:f910::
Private: 127.1.2.7
        ::1
-->
<title>Lookup Cloud IP</title>
<link rel="icon" type="image/png" sizes="32x32" href="favicon-32x32.png">
<link rel="icon" type="image/png" sizes="16x16" href="favicon-16x16.png">
<style>
body {
    background:#272822;
    color:#f8f8f2;
    font-family:Menlo,Monaco,Consolas,monospace;
    font-size:12pt;
}
a {
    color:#a8a8f2;
    text-decoration:none;
}
a:hover{
    color:#a8a8f2;
    text-decoration:underline;
}
input[type=button],input[type=submit],input[type=reset] {
    background-color: #444;
    border: none;
    color: #f8f8f2;
    padding: 2pt 20pt;
    text-decoration: none;
    cursor: pointer;
    font-family: Menlo,Monaco,Consolas,monospace;
    font-size: 12pt;
    -webkit-appearance: none;
}
input[type="text"],input[type="number"],textarea {
    background-color: #000;
    color: #cec;
    font-family: Menlo,Monaco,Consolas,monospace;
    font-size: 12pt;
    border-top-style: hidden;
    border-right-style: hidden;
    border-left-style: hidden;
    border-bottom-style: solid;
    border-bottom-width: 1px;
    border-bottom-color: #a8a8f2;
    padding: 2px;
}
input[type="text"],input[type="number"],textarea:focus {
    outline: none;
}
</style>
<script src="pako.min.js"></script>
<script src="cidr_helper.min.js"></script>
<script src="regions.js"></script>
<script src="private_ips.js"></script>
<script>
function crack_all(value, regions) {
    value.forEach(x => {
        if ("ip_prefix" in x) {
            x["ip_prefix"] = crackCidr(x["ip_prefix"]);
        } else {
            x["ipv6_prefix"] = crackCidr(x["ipv6_prefix"]);
        }
        if (x["region"] in regions) {
            x["region"] += ", " + regions[x["region"]];
        }
    });
}
crack_all(private_ips, {});
crack_all(private_ips6, {});
var ipRanges = null;
var left_to_load = 4;

function done_loading() {
    left_to_load--;
    if (left_to_load == 0) {
        helper = function() {
            document.getElementById('results').innerHTML = lookup(document.getElementById('ip').value);
        };
        document.getElementById('ip').oninput = helper;
        helper();
    }
}

fetch("https://raw.githubusercontent.com/seligman/aws-ip-ranges/master/ip-ranges.json")
    .then(response => response.json())
    .then(json => {
        ipRanges = json;
        crack_all(ipRanges["prefixes"], aws_regions);
        crack_all(ipRanges["ipv6_prefixes"], aws_regions);
        done_loading();
    });

var google_ips = null;
var google_ips6 = null;
fetch("https://raw.githubusercontent.com/seligman/cloud_sizes/master/data/raw_google.json.gz")
    .then(response => response.arrayBuffer())
    .then(text => {
        text = window.pako.inflate(text);
        text = new TextDecoder().decode(text);
        var data = JSON.parse(text);
        google_ips = [];
        google_ips6 = [];
        data['prefixes'].forEach(x => {
            if ('ipv4Prefix' in x) {
                google_ips.push({
                    "ip_prefix": x['ipv4Prefix'], 
                    "region": x['scope'], 
                    "service": x['service'], 
                    "source": "Google",
                })
            } else {
                google_ips6.push({
                    "ipv6_prefix": x['ipv6Prefix'], 
                    "region": x['scope'], 
                    "service": x['service'], 
                    "source": "Google",
                })
            }
        });
        crack_all(google_ips, google_regions);
        crack_all(google_ips6, google_regions);
        done_loading();
    });

var azure_ips = null;
var azure_ips6 = null;
fetch("https://raw.githubusercontent.com/seligman/cloud_sizes/master/data/raw_azure.json.gz")
    .then(response => response.arrayBuffer())
    .then(text => {
        text = window.pako.inflate(text);
        text = new TextDecoder().decode(text);
        var data = JSON.parse(text);
        azure_ips = [];
        azure_ips6 = [];
        data['values'].forEach(x => {
            x['properties']['addressPrefixes'].forEach(y => {
                if (y.indexOf(":") >= 0) {
                    azure_ips6.push({
                        "ipv6_prefix": y, 
                        "region": x['properties']['region'], 
                        "service": x['properties']['systemService'], 
                        "source": "Azure",
                    })
                } else {
                    azure_ips.push({
                        "ip_prefix": y, 
                        "region": x['properties']['region'], 
                        "service": x['properties']['systemService'], 
                        "source": "Azure",
                    })
                }
            });
        });
        crack_all(azure_ips, azure_regions);
        crack_all(azure_ips6, azure_regions);
        done_loading();
    });

function lookup(ip) {
    ip = ip.trim();
    if (ip.length == 0) {
        return "-";
    }
    var ret = "";
    var todo = null;
    if (!checkCidr(ip, function(i, v6){
        if (todo === null) {
            if (v6) {
                todo = ipRanges["ipv6_prefixes"]
                todo = todo.concat(google_ips6)
                todo = todo.concat(azure_ips6)
                todo = todo.concat(private_ips6);
            } else {
                todo = ipRanges["prefixes"]
                todo = todo.concat(google_ips);
                todo = todo.concat(azure_ips);
                todo = todo.concat(private_ips);
            }
        }
        if (i < todo.length) {
            return todo[i][v6 ? 'ipv6_prefix' : 'ip_prefix'];
        } else {
            return null;
        }
    }, function(i, v6) {
        ret += "Prefix: " + todo[i][v6 ? 'ipv6_prefix' : 'ip_prefix'][2] + "<br>";
        if (todo[i]['region'].length > 0) {
            ret += "Region: " + todo[i]['region'] + "<br>";
        }
        if (todo[i]['service'].length > 0) {
            ret += "Service: " + todo[i]['service'] + "<br>";
        }
        ret += "Source: " + (("source" in todo[i]) ? todo[i]["source"] : "AWS") + "<br>";
        ret += "<br>"
    })) {
        ret = "(invalid IP)";
    }
    if (ret.length==0) {
        ret = "(unknown IP)";
    }
    return ret;
}
</script>
</head>
<body onload="done_loading()">
<p>Enter an IP to lookup which service it comes from:</p>
<input type="text" size="40" id="ip" autocomplete="off" autocorrect="off">
<br><br>
<div id="results">Loading...</div>
</body>
</html>
