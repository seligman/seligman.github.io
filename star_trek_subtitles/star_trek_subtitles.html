<!DOCTYPE html><html><head><meta charset="utf-8"/><link rel="icon" type="image/png" sizes="16x16" href="spyglass.png"/><title>Search</title><style>:root {color-scheme: dark;}html,body {background-color: #333;color: #ccc;font-family: "Roboto", sans-serif;font-size: 12pt;}a {color: #ccf;text-decoration: none;}.transcriptLink {font-size: 80%;font-weight: normal;}h1 {padding-left: 0.5em;margin-top: 1.5em;margin-bottom: 0.25em;border-bottom: 1px solid #777;font-size: 14pt;color: #888;}.item {padding-bottom: 0.25em;}ul {list-style-type: none;}li {margin-bottom: 0.5em;}a:hover {color: #ccf;text-decoration: underline;}.title {font-weight: bold;border-bottom-style: solid;border-bottom-width: 1px;border-bottom-color: #888;padding-left: 1em;padding-bottom: 0;margin: 0;font-size: 12pt;}.hit {text-indent: -2em;margin-left: 2em;}.created {font-size: 8pt;}input[type="text"] {background-color: #000;color: #cec;border-top-style: hidden;border-right-style: hidden;border-left-style: hidden;border-bottom-style: solid;border-bottom-width: 1px;border-bottom-color: #a8a8f2;padding: 2px;outline: none;font-size: 12pt;}</style><script>let contextBefore = 5;let contextAfter = 500;let info = null;let batches = null;let batchData = {};async function getData(data_num, start, len, loadMode='gzipDecode') {const resp = await fetch("./search_data_" + String(data_num).padStart(2, '0') + ".dat",{'headers': {'Range': 'bytes=' + start + "-" + (start + len - 1),},},);if (loadMode == 'gzipDecode') {const blob = await resp.blob();const ds = new DecompressionStream("gzip");const decomp = blob.stream().pipeThrough(ds);const decoded = await new Response(decomp).blob();const text = await decoded.text();const parsed = JSON.parse(text);return parsed;} else if (loadMode == 'json') {const text = await resp.text();const parsed = JSON.parse(text);return parsed;}}function showHit(item, search, bail, found, showAll, batch, itemID) {let ret = [];let words = item['words'].split(' ');let filtered = words.map((val,i)=>val.replace(/[.?!,'"]/, ""));let start = [];let last = 0;for (let cur of item['start']) {last += cur;start.push(last);}let counts = {};let speakerPop = {};let speaker = item['speaker'].split('');speaker.map(x => {counts[x] = counts[x] ? counts[x] + 1 : 1;});counts["@"] = 0;counts = Object.entries(counts);counts.sort((a, b) => {if (b < a) {return -1;}if (a > b) {return 1;}return 0;});counts.map(x => {if (x[0] == "@") {speakerPop[x[0]] = '';} else {speakerPop[x[0]] = ' ' + String.fromCharCode("A".charCodeAt(0) + Object.keys(speakerPop).length) + ": ";}});let find = search.toLowerCase();let findLen = find.split(' ').length;for (let hitAt = 0; hitAt < words.length; hitAt++) {if (showAll || filtered.slice(hitAt, hitAt + findLen).join(' ').toLowerCase() == find) {let hit = document.createElement("p");ret.push(hit);let header = document.createElement("h1");hit.appendChild(header);link = document.createElement("a");header.appendChild(link);header.className = "title";link.href = item['link'];link.target = "_blank";link.innerText = (item['published'] == '1970-01-01' ? '' : (item['published'] + ": ")) + item['title'];if (batch !== null) {let span = document.createElement("span");header.appendChild(span);span.innerText = " ";let fullLink = document.createElement("a");header.appendChild(fullLink);fullLink.className = "transcriptLink";fullLink.innerText = "[transcript]";fullLink.target = "_blank";fullLink.href = "#" + batch[0] + "," + batch[1] + "," + batch[2] + "," + itemID;}let lastSpeaker = '';let phraseStartAt = 0;let startAt = -1;let phrase = null;let endedSentence = false;for (let i = Math.max(0, hitAt - contextBefore); i <= (showAll ? (words.length - 1) : Math.min(hitAt + search.length + contextAfter, words.length - 1)); i++) {if (!showAll) {if (startAt >= 0 && ((start[i] / 100) - startAt) > 60) {break;}}let curSpeaker = "";if (phrase === null || endedSentence && (lastSpeaker != speaker[i] || (start[i] - phraseStartAt) >= 45) || (start[i] - phraseStartAt) >= 120) {if (lastSpeaker != speaker[i]) {curSpeaker = speakerPop[speaker[i]];}lastSpeaker = speaker[i];phraseStartAt = start[i];if (startAt === -1) {startAt = phraseStartAt;}let text = document.createElement('p');hit.appendChild(text);text.className = "hit";let time = document.createElement('span');text.appendChild(time);let at = start[i];let val = "";val += Math.floor(at / 3600).toString() + ":";val += (Math.floor(at / 60) % 60).toString().padStart(2, "0") + ":";val += (at % 60).toString().padStart(2, "0") + ":";time.innerText = val;phrase = document.createElement('span');text.appendChild(phrase);}phrase.innerText += curSpeaker + " " + words[i];curSpeaker = "";endedSentence = ".?!".includes(words[i].slice(-1));}bail--;found++;if (showAll) {break}if (bail == 0) {let comment = document.createElement('span');ret.push(comment);comment.innerText = "(Too many hits!)";break;}}}return [ret, bail, found];}async function showTranscript(data_num, start, len, itemID) {let batch = await getData(data_num, start, len);document.title = batch[itemID]['title'];let items = showHit(batch[itemID], '', 0, 0, true, null, null);document.getElementById("results").replaceChildren(...items[0]);}function notify(desc) {let searching = document.createElement('span');searching.innerText = desc;document.getElementById("results").replaceChildren(searching);}async function search(search) {let showAll = false;let skip = 0;if (info === null) {info = await getData(0, 0, 100, "json");batches = await getData(...info['data']);}if (search.startsWith("all:")) {showAll = true;skip = parseInt(search.slice(4));} else if (search == "list") {notify("Loading...");let temp = [];let at = '';for (let batchInfo of batches) {let key = batchInfo.join('|');if (!(key in batchData)) {batchData[key] = await getData(...batchInfo);}let batch = batchData[key];let itemID = -1;for (let item of batch) {itemID++;let year = item['published'].substring(0, 4);if (year != at) {at = year;if (year != "1970") {let header = document.createElement('h1');temp.push(header);header.innerText = year;}}let hit = document.createElement('div');temp.push(hit);hit.className = "item";let link = document.createElement("a");hit.appendChild(link);link.innerText = (item['published'] == '1970-01-01' ? '' : (item['published'] + ": ")) + item['title'];link.target = "_blank";link.href = "#" + batchInfo[0] + "," + batchInfo[1] + "," + batchInfo[2] + "," + itemID;}}document.getElementById("results").replaceChildren(...temp);return;}notify("Searching...");let searchHit = search.toLowerCase();let temp = [];let bail = showAll ? 10 : 100;let found = 0;for (let batchInfo of batches) {if (bail == 0) {break;}let key = batchInfo.join('|');if (!(key in batchData)) {batchData[key] = await getData(...batchInfo);}let batch = batchData[key];let itemID = -1;for (let item of batch) {itemID++;if (skip > 0) {skip--;} else {if (bail == 0) {break;}if (showAll || (item["words"].toLowerCase()).includes(searchHit)) {let items = showHit(item, search, bail, found, showAll, batchInfo, itemID);temp = temp.concat(items[0]);bail = items[1];found = items[2];}}}}if (found == 0) {let comment = document.createElement('span');temp.push(comment);comment.innerText = "(No matches found)";}document.getElementById("results").replaceChildren(...temp);}async function showCreation() {let info = await getData(0, 0, 100, "json");contextAfter = info['after'];contextBefore = info['before'];document.getElementById('created').innerHTML = info['created'] + " with " + info['items'] + " entries";}document.addEventListener("DOMContentLoaded", function(event) {let info = window.location.hash.substring(1);info = info.split(",");if (info.length == 4) {document.getElementById("search_input").innerHTML = '';document.getElementById("footer").innerHTML = '';showTranscript(parseInt(info[0]), parseInt(info[1]), parseInt(info[2]), parseInt(info[3]));} else {showCreation().then(() => {document.getElementById("search").focus();});}});function handleKey(e) {if (e.keyCode === 13) {e.preventDefault();let val = document.getElementById('search').value.trim();if (val.length > 0) {search(val).then();}}}</script></head><body><span id="search_input">Search term: <input id="search" type="text" size=50 autocomplete="off" autocorrect="off" onkeyup="handleKey(event);"><br><br></span><span id="results">...</span><span class="created" id="footer"><hr>Created: <span id="created">(loading)</span></span></body></html>